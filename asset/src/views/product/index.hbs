<link rel="stylesheet" href="/css/product.css">

<div class="container bg-white">
    <div class="row pt-3">
        <div class="col-5">
            <div class="product-imgs">
                <img src="{{product.Images}}" alt="">
            </div>
        </div>

        <div class="col-7">
            <div class="product-info" prd="{{product.ProductId}}" usrid="{{currentUser.UserId}}">
                <h3 class="product-infor_title mt-4 me-3">{{product.Productname}}</h3>
                <h4 class="product-infor_price price">{{product.Price}}đ</h4>

                <div class="row mb-4 align-items-center">
                    <div class="col-auto">Số lượng:</div>
                    <div class="col-auto ps-0 pe-0">
                        <div id="divQuantity" class="input-group">
                            <button id="quantityMinus" class="btn btn-primary" type="button">−</button>
                            <input id="quantityInput" type="number" min="1" max="100" class="form-control" value="1">
                            <button id="quantityPlus" class="btn btn-primary" type="button">+</button>
                        </div>
                    </div>
                    <div class="col">{{product.Quantity}} sản phẩm có sẵn</div>
                </div>
            </div>

            <div class="product-infor_btn">
                <button class="btn border border-primary">
                    <i class="fa-regular fa-cart-plus"></i>
                    Thêm vào giỏ hàng</button>
                <button class="btn text-bg-primary border border-primary">Mua Ngay</button>
            </div>

        </div>
    </div>
</div>

<div class="container mt-3">
    <div class="row">
        <div class="col-8 bg-white position-relative">
            <div id="product-description" class="row">
                {{{product.Description}}}
            </div>
            <div class="divreadmore">
                <button id="btn-readmore" class="btn btn-light">Xem thêm▼</button>
            </div>
        </div>

        <div class="col-4 pe-0">
            {{#if listProduct}}
            <div class=" ps-3 pb-3 pe-2 bg-white">
                <h4 class="text-center pt-3 mb-3 w-100">Các sản phẩm nổi bật</h4>
                {{#each listProduct}}
                <div class="card border-0 mb-3">
                    <a href="" class="text-decoration-none">
                        <div class="row">
                            <div class="col-4">
                                <img src="{{this.Images}}" alt="Image" class="card-img">
                            </div>
                            <div class="col-8">
                                <h6 class="card-title text-muted mb-0">{{this.Productname}}</h6>
                                <p class="text-danger price">{{this.Price}}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {{/each}}
            </div>
            {{/if}}
        </div>
    </div>
</div>

{{!-- đánh giá sản phẩm --}}
<div class="container bg-white mt-4">
    <h4 class="rating-title">Đánh giá sản phẩm</h4>
    <hr>
    <div class="row">
        <!-- Giao diện đánh giá trung bình -->
        <div class="col evalution-statisc">
            <p>Đánh giá trung bình</p>
            <span id="averageRating">0/5</span>
            <div class="rating size-m">
                <i class="fas fa-star" data-star="1"></i>
                <i class="fas fa-star" data-star="2"></i>
                <i class="fas fa-star" data-star="3"></i>
                <i class="fas fa-star" data-star="4"></i>
                <i class="fas fa-star" data-star="5"></i>
            </div>
            <p id="totalReviews">0 đánh giá</p>
        </div>
        {{!-- giao diện thanh đánh giá --}}
        <div class="col">
            <div class="progress-statisc">
                <div class="rating-progress">
                    <span class=" pe-1">5</span>
                    <i class="fas fa-star pe-1 active"></i>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span class="total-rating ps-2">{{rating.star5}}</span>
                </div>
                <div class="rating-progress">
                    <span class=" pe-1">4</span>
                    <i class="fas fa-star pe-1 active"></i>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span class="total-rating ps-2">{{rating.star4}}</span>
                </div>
                <div class="rating-progress">
                    <span class=" pe-1">3</span>
                    <i class="fas fa-star pe-1 active"></i>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span class="total-rating ps-2">{{rating.star3}}</span>
                </div>
                <div class="rating-progress">
                    <span class=" pe-1">2</span>
                    <i class="fas fa-star pe-1 active"></i>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span class="total-rating ps-2">{{rating.star2}}</span>
                </div>
                <div class="rating-progress">
                    <span class=" pe-1">1</span>
                    <i class="fas fa-star pe-1 active"></i>
                    <div class="progress">
                        <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span class="total-rating ps-2">{{rating.star1}}</span>
                </div>
            </div>
        </div>

        <div class="col">
            <div class="d-flex flex-column align-items-center justify-content-center h-100">
                <p>Bạn đã dùng sản phẩm này?</p>
                <!-- Nút để mở modal -->
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modal-rating">GỬI ĐÁNH
                    GIÁ</button>
            </div>
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade" id="modal-rating">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 550px;">
            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Đánh Giá Sản Phẩm</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <!-- Modal Body -->
            <div class="modal-body">
                <!-- Form nhập liệu -->
                <form>
                    <div class="row">
                        <div class="d-flex justify-content-center">
                            <img src="{{product.Images}}" class="pdr-img">
                        </div>
                        <h6 class="pdr-Productname">{{product.Productname}}</h6>
                    </div>
                    <div class="d-flex flex-column align-items-center justify-content-center">
                        <div class="rating" id="rating">
                            <i class="fas fa-star" data-star="1"></i>
                            <i class="fas fa-star" data-star="2"></i>
                            <i class="fas fa-star" data-star="3"></i>
                            <i class="fas fa-star" data-star="4"></i>
                            <i class="fas fa-star" data-star="5"></i>
                        </div>
                        <div id="ratingText"></div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-2">
                            <div class="form-check">
                                <input class="form-check-input pointer" type="radio" name="gioiTinh" id="prd-male"
                                    value="Nam" checked="true">
                                <label class="form-check-label pointer" for="prd-male">Anh</label>
                            </div>
                        </div>
                        <div class="col">
                            <div class="form-check">
                                <input class="form-check-input pointer" type="radio" name="gioiTinh" id="pdr-female"
                                    value="Nữ">
                                <label class="form-check-label pointer" for="pdr-female">Chị</label>
                            </div>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <input id="pdr-username" type="text" class="form-control" placeholder="Nhập họ và tên"
                                value="{{currentUser.DisplayName}}">
                        </div>
                        <div class="col">
                            <input id="pdr-email" type="email" class="form-control" placeholder="Nhập email"
                                value="{{currentUser.Email}}">
                        </div>
                    </div>
                    <div class="mb-2">
                        <textarea class="form-control" id="pdr-description"
                            placeholder="Hãy chia sẽ cảm nhận về sản phẩm" rows="4"></textarea>
                    </div>
                </form>
            </div>
            <!-- Modal Footer -->
            <div class="modal-footer justify-content-center">
                <button id="btn-pdr_save" type="button" class="btn btn-primary">HOÀN TẤT</button>
            </div>
        </div>
    </div>
</div>
{{!-- lọc sản phẩm theo rate --}}
<div class="container mt-3 mb-3">
    <div class="rating-filter d-flex align-items-center">
        <p class="me-2">Lọc sản phẩm theo: </p>
        <button class="btn btn-outline-secondary me-2">5 sao</button>
        <button class="btn btn-outline-secondary me-2">4 sao</button>
        <button class="btn btn-outline-secondary me-2">3 sao</button>
        <button class="btn btn-outline-secondary me-2">2 sao</button>
        <button class="btn btn-outline-secondary me-2">1 sao</button>
    </div>
</div>
{{!-- các đánh giá sản phẩm --}}
<div id="templateReviewsContent" class="userRating container bg-white">
    {{#if productReviews}}
    {{#each productReviews}}
    <div class="row mb-3">
        <div class="col-auto">
            <img src="{{this.Avatar}}" alt="">
        </div>
        <div class="col">
            <p class="userRating-name">{{this.UserName}}</p>
            <div class="rating size-m" data-rating="{{this.Rating}}">
                <i class="fas fa-star" pdr-star="1"></i>
                <i class="fas fa-star" pdr-star="2"></i>
                <i class="fas fa-star" pdr-star="3"></i>
                <i class="fas fa-star" pdr-star="4"></i>
                <i class="fas fa-star" pdr-star="5"></i>
            </div>
            <p class="userRating-comment text-secondary">{{this.Description}}</p>
            <span class="text-secondary">{{this.AtCreate}}</span>
        </div>
    </div>
    {{/each}}
    {{else}}
    <div>
        <h5 class=" text-center">
            chưa có đánh giá nào cho sản phẩm này, bạn có muốn trở thành người đánh giá đầu tiên không?
        </h5>
    </div>
    {{/if}}
    {{#if productReviews}}
    <div class="d-flex justify-content-center">
        <button id="btn-pdr_prev" type="button" class="btn btn-primary me-2 disabled" onclick="btnPdRevPrev()">
            <i class="fa-solid fa-chevron-left"></i>
        </button>

        <button id="btn-pdr_next" type="button" class="btn btn-primary ms-2" onclick="btnPdRevNext()">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
    {{/if}}
</div>
{{!-- phần bình luận --}}
<div class="userRating container bg-white mt-5">
    <h4 class="rating-title">Bình Luận & Hỏi Đáp</h4>
    <hr>

    <div class="mb-3">
        {{!-- form nhập bình luận --}}
        <div class="row mb-3">
            <div class="col-3">
                <input id="pdc-username" type="text" class="form-control" placeholder="Họ và tên"
                    value="{{currentUser.DisplayName}}">
            </div>
            <div class="col-3">
                <input id="pdc-email" type="email" class="form-control" placeholder="Email (Không bắt buộc)"
                    value="{{currentUser.Email}}">
            </div>
        </div>
        <div class="form-group position-relative mb-4">
            <textarea id="pdc-comment" class="form-control" placeholder="Nhập bình luận (Tiếng việt có dấu)"
                style="resize: none; padding-right: 150px"></textarea>
            <div class="valid-feedback"></div>
            <button id="btn-pdc_send" class="btn btn-primary">Gửi bình luận </button>
        </div>
        {{!-- thông tin bình luận --}}
        {{#if ProductComments}}
        <div class="row mb-4">
            <div class="col">
                <p class="pdc-infor">
                    <span>{{totalComment}}</span> Bình luận & hỏi đáp về "<span>{{product.Productname}}</span>"
                </p>
            </div>
            <dir class="col-auto">
                <div class="d-flex align-items-center">
                    <label for="pdc-sort" class=" pe-2" style="white-space: nowrap;">Sắp xếp theo:</label>
                    <select id="pdc-sort" class="form-select">
                        <option value="newest">Mới nhất</option>
                        <option value="oldest">Cũ nhất</option>
                    </select>
                </div>
            </dir>
        </div>
        {{/if}}
        {{!-- các bình luận sản phẩm --}}
        <div id="pdc-commentsContent">
            {{#if ProductComments}}
            {{#each ProductComments}}
            <div class="row mb-3">
                <div class="col-auto">
                    <img src="{{this.Avatar}}" alt="">
                </div>
                <div class="col">
                    <p class="userRating-name">{{this.UserName}}</p>
                    <p class="userRating-comment text-secondary">{{this.Description}}</p>
                    <div class="d-flex">
                        <span class="text-secondary">{{this.AtCreate}}</span>
                        <ul class="list-unstyled d-flex ms-3">
                            <li>
                                <a href="#" class="text-primary text-decoration-none">Thích</a>
                            </li>
                            <li>
                                <a href="#" class="text-primary text-decoration-none ms-2">Trả lời</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            {{/each}}
            <div class="d-flex justify-content-center">
                <button id="btn-pdc_prev" type="button" class="btn btn-primary me-2 disabled"
                    onclick="btnPdCommentPrev()">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>

                <button id="btn-pdc_next" type="button" class="btn btn-primary ms-2" onclick="btnPdCommentNext()">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
            {{else}}
            <div>
                <h5 class=" text-center">
                    Chứa có bình luận & hỏi đáp nào trên sản phẩm này.
                </h5>
            </div>
            {{/if}}
        </div>

    </div>
</div>

<div class="container bg-white mt-4">
    <h4 class="p-3 mb-0">Các sản phẩm liên quan</h4>
    <hr>
    <div class="d-flex overflow-auto ">
        {{#if MoreProduct}}
        {{#each MoreProduct}}
        <div class="col-4">
            <div class="card border-0 mb-3">
                <a href="" class="text-decoration-none">
                    <div class="row">
                        <div class="col-4">
                            <img src="{{this.Images}}" alt="Image" class="card-img">
                        </div>
                        <div class="col-8 ps-0">
                            <h6 class="card-title mt-3 mb-2 me-1 text-muted mb-0">{{this.Productname}} ABC</h6>
                            <p class="text-danger price">{{this.Price}} BDF</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        {{/each}}
        {{/if}}
    </div>
</div>

{{!-- template productReviews --}}
<script type="text/x-handlebars-template" id="template-productReviews">
%#if productReviews%
    %#each productReviews%
    <div class="row mb-3">
        <div class="col-auto">
            <img src="%this.Avatar%" alt="">
        </div>
        <div class="col">
            <p class="userRating-name">%this.UserName%</p>
            <div class="rating size-m" data-rating="%this.Rating%">
                <i class="fas fa-star" pdr-star="1"></i>
                <i class="fas fa-star" pdr-star="2"></i>
                <i class="fas fa-star" pdr-star="3"></i>
                <i class="fas fa-star" pdr-star="4"></i>
                <i class="fas fa-star" pdr-star="5"></i>
            </div>
            <p class="userRating-comment text-secondary">%this.Description%</p>
            <span class="text-secondary">%this.AtCreate%</span>
        </div>
    </div>
    %/each%
    %/if%

    <div class="d-flex justify-content-center">
        <button id="btn-pdr_prev" type="button" class="btn btn-primary me-2" onclick="btnPdRevPrev()">
            <i class="fa-solid fa-chevron-left"></i>
        </button>

        <button id="btn-pdr_next" type="button" class="btn btn-primary ms-2" onclick="btnPdRevNext()">
            <i class="fa-solid fa-chevron-right"></i>
        </button>
    </div>
</script>

{{!-- template productComments --}}
<script type="text/x-handlebars-template" id="template-productComments">
    %#if ProductComments%
        %#each ProductComments%
        <div class="row mb-3">
            <div class="col-auto">
                <img src="%this.Avatar%" alt="">
            </div>
            <div class="col">
                <p class="userRating-name">%this.UserName%</p>
                <p class="userRating-comment text-secondary">%this.Description%</p>
                <div class="d-flex">
                    <span class="text-secondary">%this.AtCreate%</span>
                    <ul class="list-unstyled d-flex ms-3">
                        <li>
                            <a href="#" class="text-primary text-decoration-none">Thích</a>
                        </li>
                        <li>
                            <a href="#" class="text-primary text-decoration-none ms-2">Trả lời</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        %/each%
        <div class="d-flex justify-content-center">
            <button id="btn-pdc_prev" type="button" class="btn btn-primary me-2" onclick="btnPdCommentPrev()">
                    <i class="fa-solid fa-chevron-left"></i>
                </button>

                <button id="btn-pdc_next" type="button" class="btn btn-primary ms-2" onclick="btnPdCommentNext()">
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
        </div>
        %else%
        <div>
            <h5 class=" text-center">
                Chứa có bình luận & hỏi đáp nào trên sản phẩm này.
            </h5>
        </div>
        %/if%
</script>

<script>
    window.addEventListener('DOMContentLoaded', function () {

    });
</script>

<script src="/js/product.js"></script>